{{ 'component-newsletter.css' | asset_url | stylesheet_tag }}
{{ 'newsletter-section.css' | asset_url | stylesheet_tag }}

<div class="newsletter color-{{ section.settings.section_color_scheme }}{% if section.settings.show_top_border %} main-top__border{% endif %}{% if section.settings.show_bottom_border %} main-bottom__border{% endif %}" id="newsletterSection">
  {%- if section.settings.newsletter_img != blank -%}
    <img
      class="newsletter-img newsletter-img--{{ section.settings.newsletter_select }}"
      src="{{ section.settings.newsletter_img | image_url: width: 3840 }}"
      alt="{{ section.settings.newsletter_img.alt | escape }}"
      width="1920"
      height="610"
      loading="lazy">
  {%- endif -%}
  <div class="newsletter-box newsletter-form__box--{{ section.settings.newsletter_select }}">
    <div class="newsletter-form__container">
      <h4 class="newsletter-box__title">
        {{ section.settings.newsletter_title }}
      </h4>
      <p class="newsletter-box__text">
        {{ section.settings.newsletter_text }}
      </p>
      <div class="newsletter-form__box">
        {% form 'customer'
          , class: 'newsletter-form' %}
          <input
            type="hidden"
            name="contact[tags]"
            value="newsletter">
          <div
            class="newsletter-form__field-wrapper{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
            {% if settings.animations_reveal_on_scroll %}
            data-cascade
            style="--animation-order: {{ forloop.index }};"
            {% endif %}>
            <div class="field">
              <input
                id="NewsletterForm--{{ section.id }}"
                type="email"
                name="contact[email]"
                class="field__input"
                value="{{ form.email }}"
                aria-required="true"
                autocorrect="off"
                autocapitalize="off"
                autocomplete="email"
                {% if form.errors %}
                autofocus
                aria-invalid="true"
                aria-describedby="Newsletter-error--{{ section.id }}"
                {% elsif form.posted_successfully? %}
                aria-describedby="Newsletter-success--{{ section.id }}"
                {% endif %}
                placeholder="Email">
              <button
                type="submit"
                class="newsletter-form__button field__button"
                name="commit"
                id="Subscribe"
                aria-label="{{ 'newsletter.button_label' | t }}">
                {% render 'icon-newsletter-arrov' %}
              </button>
            </div>
            {%- if form.errors -%}
              <h3 class="newsletter-form__message form__message" id="Newsletter-error--{{ section.id }}">
                {%- render 'icon-error' -%}
                {{- form.errors.translated_fields.email | capitalize }}
                {{ form.errors.messages.email -}}
              </h3>
            {%- endif -%}
          </div>
          {%- if form.posted_successfully? -%}
            <h3
              class="newsletter-form__message newsletter-form__message--success form__message"
              id="Newsletter-success--{{ section.id }}"
              tabindex="-1"
              autofocus>
              {% render 'icon-success' -%}
              {{- 'newsletter.success' | t }}
            </h3>
          {%- endif -%}
        {% endform %}
      </div>
    </div>
  </div>

</div>

<script>
  var live_url = window.location.href;
  var result = live_url.includes('form_type=customer');
  //var input_val = document.querySelector('#NewsletterForm--footer').value.length;
  var input_val = document.querySelector('[id*="NewsletterForm"]').value.length;

  if (result && input_val != 0) {
    const add_ele = document.createElement("h3");
    add_ele.innerHTML = `<svg aria-hidden="true" focusable="false" class="icon icon-error" viewBox="0 0 13 13">
    <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
    <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
    <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
    <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
    </svg>You have already subscribed!`;
    document.querySelector('.newsletter-form__field-wrapper').appendChild(add_ele);
    add_ele.classList.add('newsletter_already_subscribe', 'newsletter-form__message', 'form__message');
    // live_url + '#newsletterSection';
    window.location.href = window.location.href + '#newsletterSection';
    console.log(window.location.href + '#newsletterSection');
  }
</script>

{% schema %}
  {
    "name": "t:sections.newsletter.name",
    "class": "newsletter-section",
    "settings": [
      {
        "type": "color_scheme",
        "id": "section_color_scheme",
        "label": "Color scheme",
        "default": "background-1"
      },
      {
        "type": "image_picker",
        "id": "newsletter_img",
        "label": "Image"
      },
      {
        "type": "text",
        "id": "newsletter_title",
        "label": "Heading",
        "default": "Heading"
      },
      {
        "type": "radio",
        "id": "newsletter_select",
        "label": "Content position",
        "options": [
          {
            "value": "left",
            "label": "Left"
          }, {
            "value": "centered",
            "label": "Centered"
          }, {
            "value": "right",
            "label": "Right"
          }
        ],
        "default": "right"
      }, {
        "type": "textarea",
        "id": "newsletter_text",
        "label": "Text",
        "default": "Text"
      }
    ],
    "presets": [
      {
        "name": "t:sections.newsletter.presets.name"
      }
    ]
  }
{% endschema %}